var pricings = {
    "site_type_1st": {

        "blocks_1st": {"time": 4, "price": 2100},
        "blocks_2nd": {"time": 5, "price": 2490},
        "blocks_3rd": {"time": 5, "price": 2490},
        "blocks_4th": {"time": 3, "price": 1700},
        "blocks_5th": {"time": 4, "price": 2100},
        "blocks_6th": {"time": 5, "price": 4490},
        "blocks_7th": {"time": 3, "price": 1650},
        "blocks_8th": {"time": 3, "price": 1700},
        "blocks_9th": {"time": 3, "price": 1700},

        "funcs_1st": {"time": 2, "price": 1300},
        "funcs_2nd": {"time": 0.5, "price": 700},
        "funcs_3rd": {"time": 0.2, "price": 80},

        "management": 10100
    },

    "site_type_2nd": {

        "blocks_10th": {"time": 4, "price": 2100},
        "blocks_11th": {"time": 4, "price": 2100},
        "blocks_12th": {"time": 4, "price": 2100},
        "blocks_13th": {"time": 4, "price": 2100},
        "blocks_14th": {"time": 4, "price": 2100},
        "blocks_15th": {"time": 4, "price": 2100},
        "blocks_16th": {"time": 4, "price": 2100},
        "blocks_17th": {"time": 4, "price": 2100},
        "blocks_18th": {"time": 3, "price": 1700},
        "blocks_19th": {"time": 5, "price": 2490},

        "funcs_4th": {"time": 3, "price": 1750},
        "funcs_5th": {"time": 0.5, "price": 700},
        "funcs_6th": {"time": 0.2, "price": 280},

        "management": 10100
    },

    "site_type_3rd": {

        "blocks_20th": {"time": 18, "price": 7700},
        "blocks_21st": {"time": 14, "price": 6100},
        "blocks_22nd": {"time": 12, "price": 5300},
        "blocks_23rd": {"time": 14, "price": 6100},
        "blocks_24th": {"time": 12, "price": 5300},
        "blocks_25th": {"time": 12, "price": 5300},
        "blocks_26th": {"time": 12, "price": 5300},
        "blocks_27th": {"time": 10, "price": 4500},
        "blocks_28th": {"time": 13, "price": 5700},
        "blocks_29th": {"time": 13, "price": 5690},

        "funcs_7th": {"time": 2, "price": 1100},
        "funcs_8th": {"time": 0.5, "price": 700},
        "funcs_9th": {"time": 0.2, "price": 280},
        "funcs_10th": {"time": 10, "price": 4490},
        "funcs_11th": {"time": 0.2, "price": 280},

        "management": 13600
    },

    "site_type_4th": {

        "blocks_30th": {"time": 28, "price": 11700},
        "blocks_31st": {"time": 21, "price": 8900},
        "blocks_32nd": {"time": 21, "price": 8900},
        "blocks_33rd": {"time": 15, "price": 6500},
        "blocks_34th": {"time": 18, "price": 7700},
        "blocks_35th": {"time": 12, "price": 5300},
        "blocks_36th": {"time": 12, "price": 5300},
        "blocks_37th": {"time": 15, "price": 6500},
        "blocks_38th": {"time": 12, "price": 5300},
        "blocks_39th": {"time": 15, "price": 6500},

        "funcs_12th": {"time": 2, "price": 1300},
        "funcs_13th": {"time": 0.2, "price": 580},
        "funcs_14th": {"time": 0.2, "price": 580},
        "funcs_15th": {"time": 4, "price": 2100},
        "funcs_16th": {"time": 18, "price": 7700},

        "management": 15600
    },

    "site_type_5th": {

        "blocks_40th": {"time": 38, "price": 15700},
        "blocks_41st": {"time": 21, "price": 8900},
        "blocks_42nd": {"time": 21, "price": 8900},
        "blocks_43rd": {"time": 15, "price": 6500},
        "blocks_44th": {"time": 18, "price": 7700},
        "blocks_45th": {"time": 12, "price": 5300},
        "blocks_46th": {"time": 12, "price": 5300},
        "blocks_47th": {"time": 15, "price": 6500},
        "blocks_48th": {"time": 12, "price": 5300},
        "blocks_49th": {"time": 15, "price": 6500},
        "blocks_50th": {"time": 15, "price": 6500},

        "funcs_17th": {"time": 2, "price": 1300},
        "funcs_18th": {"time": 0.2, "price": 580},
        "funcs_19th": {"time": 0.2, "price": 580},
        "funcs_20th": {"time": 4, "price": 2100},
        "funcs_21st": {"time": 38, "price": 15700},
        "funcs_22nd": {"time": 30, "price": 12500},

        "management": 19900
    },

    "site_type_6th": {

        "blocks_51st": {"time": 4, "price": 2100},
        "blocks_52nd": {"time": 4, "price": 2100},
        "blocks_53rd": {"time": 5, "price": 2500},
        "blocks_54th": {"time": 4, "price": 2100},
        "blocks_55th": {"time": 3, "price": 1700},
        "blocks_56th": {"time": 3, "price": 1700},
        "blocks_57th": {"time": 3, "price": 1700},
        "blocks_58th": {"time": 4, "price": 2100},
        "blocks_59th": {"time": 5, "price": 2500},
        "blocks_60th": {"time": 6, "price": 2900},
        "blocks_61st": {"time": 5, "price": 2500},
        "blocks_62nd": {"time": 4, "price": 2100},
        "blocks_63rd": {"time": 3, "price": 1700},
        "blocks_64th": {"time": 3, "price": 1700},

        "funcs_23rd": {"time": 2, "price": 1300},
        "funcs_24th": {"time": 0.5, "price": 700},
        "funcs_25th": {"time": 0.2, "price": 580},
        "funcs_26th": {"time": 0.2, "price": 580},
        "funcs_27th": {"time": 5, "price": 2500},

        "management": 10100
    }
};

var current,
    prev = "site_type_1st",
    block, newdiv,
    tags = [],
    result;

function countPricing(current, pricings, tags) {
    let result = {
        "time": 0,
        "price": pricings[current]["management"]
    };

    for (let tag of tags) {
        result["time"] += pricings[current][tag]["time"];
        result["price"] += pricings[current][tag]["price"];

        result["time"] = Number((result["time"].toFixed(1)));
    }

    return result;
}

function setPrices() {
    result = countPricing(current, pricings, tags);

    $("div#days")[0].innerHTML = result["time"];
    $("div#price")[0].innerHTML = result["price"];
    $("input#d").val(result["time"]);
    $("input#p").val(result["price"]);
}

function setSection() {
    $("section#" + current).css("display", "block");
    $("section#" + prev).css("display", "none");
    $("input[type='checkbox']").prop({'checked': false});
    tags = [];
}

$(function () {
    $("input#phone_no").mask("8 (999) 999-99-99", {placeholder: "8 (___) ___-__-__"});
});

$("input[type='radio']").on("change", function (e) {
    if (e.currentTarget.id !== "host_1st" && e.currentTarget.id !== "host_2nd") {
        prev = current;
        current = e.currentTarget.id;
        setSection();
        setPrices();
    }
});

$("input[type='checkbox']").on("change", function (e) {
    if (e.currentTarget.name === "blocks[]") {
        block = $("div#blocks");
    } else if (e.currentTarget.name === "funcs[]") {
        block = $("div#funcs");
    }

    if (e.currentTarget.checked) {
        newdiv = $("<p id='" + e.currentTarget.id + "'>-" + e.currentTarget.value + "</p>");
        block.append(newdiv);
        tags.push(e.currentTarget.id);
    } else {
        $("p#" + e.currentTarget.id).remove();
        for (var i = 0; i < tags.length; i++) {
            if (tags[i] === e.currentTarget.id) {
                tags.splice(i, 1);
            }
        }
    }

    result = countPricing(current, pricings, tags);

    console.log(result);

    setPrices();
});
